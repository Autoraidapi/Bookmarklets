"use strict";var BLOCK_GENERIC=0,BLOCK_IF=1,BLOCK_FOR=2,BLOCK_WHILE=3,BLOCK_WITH=4,BLOCK_SWITCH=5,BLOCK_ELSE_SPACE=6,rootBlock,parseErrors=[],prevIfBlock=null,isInsideVoidFunction=!1;function ParseError(e,t){this.length=2,this.str=e,this.pos=t}function BlockElement(e){this.length=8,this.strStart="",this.strEnd="",this.type=BLOCK_GENERIC,this.level=0,this.pos=-1,this.indented=!1,this.parent=e,this.children=[],null!=this.parent&&(e.children[e.children.length]=this,this.level=e.level+1)}function addParseError(e,t){parseErr=new ParseError(e,t),parseErrors[parseErrors.length]=parseErr}function scan(e){return parseErrors.length=0,doScan(e)}function doScan(e){function t(e,t,r){if(e.type!=BLOCK_GENERIC){var n=nextSignificantChar(t,r+1);if("{"!=n&&";"!=n)return!0}return!1}function r(e){return e=new BlockElement(e)}function n(e){return e=new BlockElement(e.parent)}function s(e){for(var t=e;t.indented;){if(null==t.parent)return t;t=t.parent}return t}var a,i=-1,o="",l=null;for((l=new BlockElement(null)).level=-1,rootBlock=l,l=new BlockElement(l);i<e.length;)switch(i+=1,a=e.charAt(i)){default:o+=a,l.strStart=o;break;case'"':case"'":if(-1==(f=endOfStringIndex(e,a,i,!1)))return!1;o+=e.substring(i,f+1),i=f,l.strStart=o;break;case";":if(getStatementType(o+=a)!=BLOCK_IF&&null!=l.parent&&l.parent.type!=BLOCK_IF&&(prevIfBlock=null),l.strStart=o,"/"==nextSignificantChar(e,i+1));else if(o="",l.indented)l=n(null!=(c=s(l))?c:l);else l=n(l);break;case"\n":case"\r":break;case"(":if(o+=a,l.strStart=o,l.type=getStatementType(o),prevIfBlock=l.type==BLOCK_IF?l:null,0==e.substring(i).indexOf("(function()"))i=i+(o="(function()").length-1,l.strStart=o,isInsideVoidFunction=!0;else{if(-1==(f=matchingParenthesisIndex(e,"(",")",i-1)))return addParseError("Expression is missing closing parenthesis )",i),!1;o+=e.substring(i+1,f+1),i=f,l.strStart=o,t(l,e,i)&&(o="",(l=new BlockElement(l)).indented=!0)}break;case")":if(0!=e.substring(i).replace(/[ \n\r]/g,"").indexOf(")()"))return addParseError("Closing parenthesis ) without opening parenthesis (",i),!1;o=")()",i+=e.substring(i+1).indexOf(")")+1,i+=e.substring(i+1).indexOf(")")+1,l.strStart=o,isInsideVoidFunction=!1;break;case"{":if(o+=a,l.strStart=o,l=r(l),-1==matchingParenthesisIndex(e,"{","}",i-o.length))return addParseError("Expression is missing closing bracket }",i),!1;o="";break;case"}":if(";"!=prevSignificantChar(e,i-1))if(l.indented)null!=(c=s(l))&&(l=n(c));if(null!=(l=l.parent)){if(l.strEnd=a,-1==l.strStart.indexOf("{"))return addParseError("Closing bracket } without opening bracket {",i),!1;var c;l=n(null!=(c=s(l))?c:l)}o="";break;case":":"javascript:"==trimLeadingSpaces(o+=a)&&(l.strStart=o,o="",l=n(l));break;case"e":if("else"==trimLeadingSpaces(o+=a))if("{"!=nextSignificantChar(e,i+1))if(" "==(u=e.charAt(i+1))||"\r"==u||"\n"==u||"\t"==u){if(null==prevIfBlock&&null!=l.parent&&l.parent.children.length>1){var d=l.parent.children[l.parent.children.length-2];if(d.type!=BLOCK_IF)return addParseError("ELSE without IF",i),!1;prevIfBlock=d}l.parent.children.length-=1,l=null,(l=n(prevIfBlock)).indented=prevIfBlock.indented,prevIfBlock=null,l.strStart=o,o="",l.type=BLOCK_ELSE_SPACE,t(l,e,i)&&(o="",(l=new BlockElement(l)).indented=!0)}break;case"\\":o+=a,o+=getChar(e,i+=1),l.strStart=o;break;case"/":var u;if("("==(u=prevSignificantChar(e,i))||"="==u){if(-1==(f=endOfStringIndex(e,a,i,!0)))return!1;o+=e.substring(i,f+1),i=f,l.strStart=o}else if("/"==e.charAt(i-1)&&"*"!=nextSignificantChar(e,i+1)){if(-1==(f=endOfLineIndex(e,i)))return!1;i=f-1,o=o.substring(0,o.length-1)+"\n",l.strStart=""}else o+=a,l.strStart=o;break;case"*":if("/"==e.charAt(i-1)){var f;if(-1==(f=e.indexOf("*/",i)))return!1;o+=e.substring(i,f+2)+"\n",i=f+1,l.strStart=o}else o+=a,l.strStart=o}return!0}function matchingParenthesisIndex(e,t,r,n){for(var s,a=n,i=0;a<e.length;)switch(a+=1,s=e.charAt(a)){default:if(s==t)i+=1;else if(s==r&&0==(i-=1))return isInsideVoidFunction&&"("==t&&0==e.substring(a).replace(/[ \n\r]/g,"").indexOf(")()")?-1:a;break;case'"':case"'":if(-1==(l=endOfStringIndex(e,s,a,!1)))return-1;a=l;break;case"/":var o=prevSignificantChar(e,a);if("("==o||"="==o){if(-1==(l=endOfStringIndex(e,s,a,!0)))return-1;a=l;break}if("/"==e.charAt(a-1)){if(-1==(l=endOfLineIndex(e,a)))return-1;a=l}break;case"*":if("/"==e.charAt(a-1)){var l;if(-1==(l=e.indexOf("*/",a)))return-1;a=l+1}}return-1}function endOfStringIndex(e,t,r,n){for(var s,a=r;a<e.length;)switch(a+=1,s=e.charAt(a)){default:if(s==t)return a;break;case"\r":case"\n":return addParseError("Unterminated string",r),-1;case"\\":a+=1;break;case"[":if(n){var i=endOfStringIndex(e,"]",a,!0);if(-1==i)return addParseError("Unterminated regular expression - missing ]",r),-1;a=i}}return addParseError("Unterminated string",r),-1}function endOfLineIndex(e,t){for(var r,n=t;n<e.length;)switch(n+=1,r=e.charAt(n)){default:if("\n"==r)return n;break;case"\\":n+=1}return addParseError("Unterminated comment(?)",t),-1}function getStatementType(e){return findSubstatement(e,"if")?BLOCK_IF:findSubstatement(e,"for")?BLOCK_FOR:findSubstatement(e,"while")?BLOCK_WHILE:findSubstatement(e,"with")?BLOCK_WITH:findSubstatement(e,"switch")?BLOCK_SWITCH:BLOCK_GENERIC}function findSubstatement(e,t){var r=e.toLowerCase();return r=trimLeadingSpaces(r),t=t.toLowerCase(),0==r.indexOf(t)&&"("==nextSignificantChar(r,t.length)}function getChar(e,t){var r=e.charAt(0);return null!=r?r:""}function nextSignificantChar(e,t){var r=e.substring(t);return(r=trimLeadingSpaces(r)).length>0?r.charAt(0):""}function prevSignificantChar(e,t){for(var r=e.substring(0,t);r.length>0&&" "==r.charAt(r.length-1);)r=r.substring(0,r.length-1);return r.length>0?r.charAt(r.length-1):""}function getFormattedText(){var e=doGetFormattedText(rootBlock);return e=e.replace(/\t/g,indent(1))}function doGetFormattedText(e){var t="";""!=e.strStart&&""!=trimLeadingSpacesAndTabs(e.strStart)&&(t=indent(e.level)+trimLeadingSpacesAndTabs(e.strStart)+"\r\n");for(var r=0;r<=e.children.length-1;r+=1)t+=doGetFormattedText(e.children[r]);return""!=e.strEnd&&(t+=indent(e.level)+e.strEnd+"\r\n"),t}function getCompressedText(){var e=doGetCompressedText(rootBlock);return e=(e=(e=replaceOutsideStrings(e=e.replace(/\t/g,"")," ","")).replace(/else \{/g,"else{")).replace(/void \(/g,"void(")}function doGetCompressedText(e){var t="";e.type==BLOCK_ELSE_SPACE&&(e.strStart+=" "),""!=e.strStart&&""!=trimLeadingSpacesAndTabs(e.strStart)&&(t=trimLeadingSpacesAndTabs(e.strStart)+"\r\n");for(var r=0;r<=e.children.length-1;r+=1)t+=doGetCompressedText(e.children[r]);return""!=e.strEnd&&(t+=e.strEnd+"\r\n"),t}function indent(e){for(var t="",r=0;r<2*e;r+=1)t+=" ";return t}function trimLeadingSpaces(e){for(var t=e;t.match(/^ /);)t=t.replace(/^ /,"");return t}function trimLeadingSpacesAndTabs(e){for(var t=trimLeadingSpaces(e);t.match(/^\t/);)t=trimLeadingSpaces(t=t.replace(/^\t/,""));return t}function getErrorText(e){var t="";if(parseErrors.length>0){var r=parseErrors[0];t+="Pos. "+r.pos+": "+r.str,t+="\n \n"+e.substring(0,r.pos+1),t+="  <---"}return t}function replaceOutsideStrings(e,t,r){var n,s=-1,a="";function i(){for(var t=["var ","new ","function ","return ","throw ","typeof ","do ","else ","void "," in "],r=0;r<t.length;r+=1)if(0==e.substring(s).indexOf(t[r]))return s+=t[r].length-1,a+=t[r],!0;return!1}for(;s<e.length;)switch(s+=1,n=e.charAt(s)){default:i()||(n==t.charAt(0)&&0==e.substring(s).indexOf(t)?(s+=t.length-1,a+=r):a+=n);break;case'"':case"'":if(-1==(l=endOfStringIndex(e,n,s)))return"";a+=e.substring(s,l+1),s=l;break;case"\\":a+=n,s+=1,a+=e.charAt(s);break;case"/":var o=prevSignificantChar(e,s);if("("==o||"="==o){if(-1==(l=endOfStringIndex(e,n,s,!0)))return"";a+=e.substring(s,l+1),s=l}else a+=n;break;case"*":if("/"==e.charAt(s-1)){var l;if(-1==(l=e.indexOf("*/",s)))return"";a+=e.substring(s,l+2),s=l+1}else a+=n}return a}var isIE=!(!document.all||!document.execCommand),isNS=!document.all,isOP=!(!document.all||document.execCommand),objName="",objs=[],lvls=[],exprHistory=[],exprHistoryIndex=-1;function evalExpr(){var e=(objName=document.forms[0].elements.txtExpr.value).split("[");lvls.length=0;for(var t=0;t<e.length;t+=1)lvls=lvls.concat(e[t].split("."));for(t=0;t<lvls.length;t+=1)lvls[t].indexOf("]")==lvls[t].length-1&&(lvls[t]=lvls[t].substring(0,lvls[t].length-1))}function getPropsString(e){var t=[];for(var r in e)t.push(r);t=t.sort();for(var n="",s=0;s<t.length;s+=1)try{"function"==typeof e[t[s]]?n+=t[s]+" = [function]\n":n+=t[s]+" = "+e[t[s]]+"\n"}catch(e){n+=objs[s]+" = ["+e.description+"]\n"}return n}function getProps(keepForwardHistory){if(window.opener.closed)alert("The referring window has been closed.");else{var obj=null;evalExpr();try{obj=eval("window.opener."+objName)}catch(e){alert("Could not evaluate object.")}var slct=document.forms[0].elements.evalresult;slct.length=0,objs.length=0,isIE?getElementsIE(slct,obj):(isNS||isOP)&&getElementsNS(slct,obj),updateHistory(keepForwardHistory)}}function updateHistory(e){e||exprHistory[exprHistoryIndex]==document.forms[0].elements.txtExpr.value||(exprHistoryIndex+=1,exprHistory.length=exprHistoryIndex,exprHistory.push(document.forms[0].elements.txtExpr.value));var t=document.forms[0].elements.btnBack,r=document.forms[0].elements.btnForward;exprHistoryIndex<=0?(t.disabled=!0,t.title="",isOP&&(t.style.color="gray")):(t.disabled=!1,t.title=exprHistory[exprHistoryIndex-1],isOP&&(t.style.color="")),exprHistoryIndex>=exprHistory.length-1?(r.disabled=!0,r.title="",isOP&&(r.style.color="gray")):(r.disabled=!1,r.title=exprHistory[exprHistoryIndex+1],isOP&&(r.style.color=""))}function getElementsIE(e,t){try{for(var r in t){objs.push(r);var n=document.createElement("OPTION");e.add(n,0)}}catch(e){alert("Could not evaluate object:\n"+e.description)}objs=objs.sort();for(var s=0;s<objs.length;s+=1){var a=e[s];try{a.name=objs[s],a.innerText=objs[s]+" = "+t[objs[s]]}catch(e){a.innerText=objs[s]+" = ["+e.description+"]"}}}function getElementsNS(e,t){for(var r=[],n=[],s=[],a=0,i=t;i;i=i.__proto__)r[a]=[],n[a]=[],s[a]=[],a+=1;for(var o in t){var l=-1;try{for(i=t;i&&o in i;i=i.__proto__)++l}catch(e){l=0}try{"function"==typeof t[o]?n[l].push(o):r[l].push(o)}catch(e){s[l].push(o)}}for(var c=0;c<a;c+=1){addArrayNS(r[c],"Properties",e,t),addArrayNS(n[c],"Methods",e,t),addArrayNS(s[c],"Indeterminate",e,t)}}function addArrayNS(e,t,r,n){if(e.length>0){var s=document.createElement("OPTION");s.name="(category)",s.innerHTML="-------------------- "+t+" --------------------",r.appendChild(s),e=e.sort();for(var a=0;a<e.length;a+=1){s=document.createElement("OPTION");try{if(s.name=e[a],"innerHTML"==e[a])s.innerHTML="innerHTML = [Not shown]";else{var i;if(1==n[e[a]].toString().indexOf("function ")){var o=n[e[a]].toString();o=o.substring(0,o.indexOf("{")+1)+" [...] }",i=document.createTextNode(e[a]+" = "+o)}else i=document.createTextNode(e[a]+" = "+n[e[a]]);s.appendChild(i)}}catch(t){s.innerHTML=e[a]+" = ["+t+"]"}r.appendChild(s)}}}function selectProp(e){-1!=e.selectedIndex&&"(category)"!=e[e.selectedIndex].name&&(lvls.push(e[e.selectedIndex].name),showProps())}function goUp(){lvls.length>1&&(lvls.length-=1,showProps())}function goBack(){exprHistoryIndex>0&&(exprHistoryIndex-=1,document.forms[0].elements.txtExpr.value=exprHistory[exprHistoryIndex],getProps(!0))}function goForward(){exprHistory.length>exprHistoryIndex-1&&(exprHistoryIndex+=1,document.forms[0].elements.txtExpr.value=exprHistory[exprHistoryIndex],getProps(!0))}function showProps(){for(var e="",t=0;t<lvls.length;t+=1)isNaN(lvls[t])?(""!=e&&(e+="."),e+=lvls[t]):e+="["+lvls[t]+"]";document.forms[0].elements.txtExpr.value=e,getProps()}function browseTo(e){document.forms[0].elements.txtExpr.value=e,document.forms[0].elements.btnGet.click()}var NS4=!!document.layers,NS6=!(!document.getElementById||document.all),IE4=!(!document.all||!document.execCommand),INLINE_EDIT=!0,isBmkLinkActive=!1;function displayHTML(e,t,r){IE4?document.all[e].innerHTML=t:NS4||(document.getElementById(e).innerHTML=t)}function displayText(e,t){IE4?document.all[e].innerText=t:NS4||(document.getElementById(e).innerHTML=t)}function updateLinks(e,t){displayHTML("bookmark","<a href='' name='bmklink'>"+e.elements.bmkname.value+"</a>"),IE4?document.all.bmklink.href=t:document.links[1].href=t}function addToFavorites(e){if(IE4){var t=e.elements.jscode.value;if(scan(t)){updateLinks(e,getCompressedText());var r=e.elements.bmkname.value;try{self.external.addFavorite(document.all.bmklink.href,r)}catch(e){self.alert("Could not add script to Favorites.")}}else displayError(getErrorText(t))}else alert("Only supported in Internet Explorer")}function presentCompressedSource(e){var t=e.elements.jscode.value;if(scan(t)){var r=getCompressedText(),n=r.replace(/\r/g,"");n=n.replace(/\n/g,""),INLINE_EDIT?(e.elements.WrapChk.checked=!0,wrapText(e),e.elements.jscode.value=n,displayText("formatsrc",n.length+" characters")):displayText("formatsrc",n+"\n \n"+n.length+" characters"),updateLinks(e,r)}else displayError(getErrorText(t))}function presentFormattedSource(e){var t=e.elements.jscode.value;if(scan(t)){var r=getFormattedText(),n=getCompressedText(),s=n.replace(/\r/g,"");s=s.replace(/\n/g,""),INLINE_EDIT?(e.elements.WrapChk.checked=!1,wrapText(e),e.elements.jscode.value=r,displayText("formatsrc",s.length+" characters")):displayText("formatsrc",r+"\n \n"+s.length+" characters"),updateLinks(e,n)}else displayError(getErrorText(t))}function displayError(e){if(displayText("formatsrc",e),displayHTML("bookmark","<font color='red'>ERROR</font>"),IE4){for(var t=parseErrors[0].pos,r=0,n=-1;r>-1&&r<t;)r=document.all("jscode").value.indexOf("\n",r+1),n+=1;gotoCursorPos(t-=n)}}function replaceEscape20(e){e.elements.jscode.value=replaceOutsideStrings(e.elements.jscode.value,"%20"," ")}function replaceAll(e){var t=prompt("Replace...","");if(t){var r=prompt("...with:","");if(r){var n=new RegExp(t,"gi");e.elements.jscode.value=e.elements.jscode.value.replace(n,r)}}}function wrapText(e){e.elements.WrapChk.checked?e.elements.jscode.wrap="soft":e.elements.jscode.wrap="off"}function setEditorHeight(e){isNaN(e.elements.jscodeheight.value)||parseInt(e.elements.jscodeheight.value)<5?e.elements.jscodeheight.value=e.elements.jscode.rows:e.elements.jscode.rows=parseInt(e.elements.jscodeheight.value)}function gotoCursorPos(e){try{var t=document.forms[0].elements.jscode.createTextRange();t.move("character",e),t.select()}catch(e){}}function promptCursorPos(){var e=prompt("Cursor position:","");null==e||isNaN(e)||gotoCursorPos(e)}function addBraces(e){var t=e.elements.jscode,r=t.value.indexOf("javascript:");if(r>=0){var n="javascript:";n+="(function(){"+t.value.substring(r+"javascript:".length)+"})()",t.value=n}}if(IE4)try{var pastedText=clipboardData.getData("Text");0==pastedText.indexOf("javascript:")&&(document.forms[0].elements.jscode.value=pastedText)}catch(e){}else document.forms[0].elements.JumpBtn.style.visibility="hidden";function handleError(e,t,r){if("bmklink"==document.activeElement.name){var n="Runtime error.\n",s=event.errorCharacter;return n+="\nError:\t"+e,n+="\nLine:\t"+r,n+="\nChar:\t"+s,n+="\nStmt.:\t"+gotoErrorPos(s)+"...",alert(n),!0}return!1}function gotoErrorPos(e){for(var t,r=unescape(document.forms[0].elements.jscode.value),n=getCompressedText(),s=unescape(n).replace(/[\t\r\n]/g,"").substr(e+10),a=(e=0,"");;){if(";"==(t=s.charAt(e))||")"==t||"}"==t||e>=s.length-1)break;a+=t,e+=1}return gotoCursorPos(unescape(r).replace(/[\t\r]/g,"").indexOf(a)),a}function handleBmkLinkBlur(){isBmkLinkActive=!1}function handleBmkLinkFocus(){isBmkLinkActive=!0}IE4&&(window.onerror=handleError);