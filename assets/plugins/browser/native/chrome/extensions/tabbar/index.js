window._translations=window._translations||{},function(){function e(e,t){e&&t&&(e.close.style.navDown="#"+t.close.id,t.close.style.navUp="#"+e.close.id),!e&&t&&(t.close.style.navUp=""),e&&!t&&(e.close.style.navDown="")}function t(e){var t=p.getTiming(e.hoverOutAnimationType);e.hoverStyleElement.style.webkitTransitionDuration=t+"ms",e.hoverInClass&&e.hoverStyleElement.classList.contains(e.hoverInClass)&&I.transitionWithTimeout(e.hoverStyleElement,function(){e.hoverStyleElement.classList.remove(e.hoverInClass)},t+100,function(){v!==e&&e.hoverOut&&e.hoverOut()}),e.hoverOutClass&&e.hoverStyleElement.classList.add(e.hoverOutClass)}function n(e,n){(n.hoverOutElement===e.hoverTargetElement||"click"===n.event.type)&&window.webkitRequestAnimationFrame(function(){t(e)}),n.targetElement===e.hoverTargetElement&&(n.event.stopPropagation(),R&&n.hoverInElement===e.hoverTargetElement&&(v&&t(v),v=e,e.hoverIn&&e.hoverIn(),e.hoverStyleElement.style.webkitTransitionDuration=p.getTiming(e.hoverInAnimationType)+"ms",e.hoverOutClass&&e.hoverStyleElement.classList.remove(e.hoverOutClass),e.hoverInClass&&e.hoverStyleElement.classList.add(e.hoverInClass)),R&&"click"===n.event.type&&e.onHoverTargetClick&&e.onHoverTargetClick(),!R||"touchstart"!==n.event.type&&"mousedown"!==n.event.type||n.hoverInElement!==e.hoverTargetElement||document.activeElement===e.hoverTargetElement||document.activeElement.blur(),R&&"touchend"===n.event.type&&e.onHoverTargetTouchEnd&&n.hoverOutElement===e.hoverTargetElement&&(n.event.preventDefault(),e.onHoverTargetTouchEnd()),("touchend"===n.event.type||"mouseup"===n.event.type)&&(R=!0,v=void 0))}function i(e){var t={hoverInClass:"tab-row-pressed",hoverInAnimationType:p.TABBAR_ITEM_HIGHLIGHT_HOVER_IN,hoverOutAnimationType:p.TABBAR_ITEM_HIGHLIGHT_HOVER_OUT};t=C.extend(t,e);var i={hoverTargetElement:function(){return t.hoverTargetElement},hoverEvent:n.bind(this,t)};return y.register(i),i}function o(){var e=U.first();if(e){var t=e.imgContainer.offsetWidth+parseInt(document.defaultView.getComputedStyle(e.imgContainer,"").getPropertyValue("margin-right"),10);window.opener.require("plugins/tabbar/index").extensionPrivate.setThumbnailWidth(t)}}function a(e){if(w===e)return W(),void 0;var t=U.get(w);t&&(t.row.classList.remove("tab-row-selected"),t.row.classList.remove("tab-row-pressed"),t.background.style.webkitTransitionDuration=p.getTiming(p.TABBAR_TAB_SELECTION_OUT)+"ms"),w=e,t=U.get(e),t.row.classList.add("tab-row-selected"),O&&window.opener.require("plugins/tabbar/index").isShowing()||W(),t.background.style.webkitTransitionDuration=p.getTiming(p.TABBAR_TAB_SELECTION_IN)+"ms"}function r(e){var t=U.get(e);if(t){var n=p.getTiming(p.TABBAR_IMAGE_FADE_IN);t.newImgContainer.style.webkitTransitionDuration=n+"ms",t.newImgContainer.style.webkitTransitionTimingFunction=p.getCurve(),I.transitionWithTimeout(t.newImgContainer,function(){t.newImgContainer.style.opacity=1},n+100,function(){if(t=U.get(e),t&&(t.oldImg.src=t.currentImageData,t.updatingThumbnail=!1,t.pendingThumbnail)){var n=t.pendingThumbnail;delete t.pendingThumbnail,it(e,n)}})}}function s(){h&&(h.cancel(),h=void 0),g&&(g.style.webkitTransitionDuration="0ms",g.classList.remove("tab-row-pressed"),g=void 0)}function l(e){s(),g=e;var t=p.getTiming(p.FULL_SELECTION);e.style.webkitTransitionDuration=t+"ms",e.style.webkitTransitionTimingFunction=p.getCurve(),h&&h.cancel(),h=I.transitionWithTimeout(e,function(){e.classList.add("tab-row-pressed")},t+100)}function d(){var e=document.getElementById("tab-scroll-area").scrollTop,n=Math.abs(0-e);n>=S&&v&&(R=!1,t(v),v=void 0)}function c(e){var t=U.get(e);if(t){var n=p.getTiming(p.DISABLE_TAB);t.overlay.style.webkitTransitionDuration=n+"ms",t.row.classList.remove("tab-row-disabled")}delete _[e]}function u(){return document.activeElement.dataset.tabId}function m(e){document.body.setAttribute("aria-hidden",e)}var b,v,w,g,h,p=window.opener.require("ui/animationTimings"),T=window.opener.require("iris/application"),E=window.opener.require("iris/event"),y=window.opener.require("ui/hover/hoverController"),f=window.opener.require("iris/i18n"),I=window.opener.require("ui/utils"),C=window.opener.require("iris/utils"),k=window.opener.require("iris/tabs/controller"),_=[],L="Untitled",B="Home Page",x="Bookmarks",A="History",N="New Tab",H="k",q="h",D="Close Tab",S=15,O=!1,R=!0,U=C.createLinkedHashMap(e),F=function(e){window.opener.require("iris/event").emit("tabbar.itemClicked",[e])},P=function(){window.opener.require("plugins/tabbar/index").extensionPrivate.loadHomePage()},z=function(){window.opener.require("plugins/screens/bookmarks_main/index").show()},V=function(){window.opener.require("plugins/screens/history_date/index").show()},G=function(){window.opener.require("plugins/tabbar/index").hide(),window.opener.require("iris/tabs/controller").createNewTab()},M=function(e){window.opener.require("iris/tabs/controller").update(e,{selected:!0}),window.opener.require("plugins/tabbar/index").hide()},W=function(){U.get(w).splat.className=""},j=function(){I.preventUserInteraction(),window.opener.require("plugins/tabbar/index").hide(),W()},J=function(e){console.log("Close tab "+e);var t=window.opener.require("iris/tabs/controller").get(e);t&&(console.log("Requesting to close tab "+e+", webviewId "+t.webviewId),t.webviewId?window.opener.qnx.callExtensionMethod("webview.destroyIfNotRejectedByUser",t.webviewId):window.opener.require("iris/tabs/controller").remove(e))},K=function(e){console.log("Reset tab "+e),window.opener.require("iris/tabs/controller").reset(e)},Q=function(){window.opener.require("plugins/tabbar/index").extensionPrivate.updateTabInfo()},X=function(){window.opener.require("plugins/tabbar/index").extensionPrivate.updateCurrentTabThumbnail()},Y=function(e){for(var t=document.getElementById("tab-scroll-area").childNodes,n=0;t.length>n;++n)if(e===t[n])return n;return null},Z=function(e){if(U.contains(e.id))return console.log("Getting a second onCreated for tab with id "+e.id+". Ignoring."),void 0;console.log("tab created with id "+e.id);var t=document.createElement("div");t.tabIndex="1",t.className="tab-row",t.id="tab-"+e.id,t.dataset.tabId=e.id,t.setAttribute("role","menuitem");var n=document.createElement("div");n.className="tab-image-container",n.setAttribute("aria-hidden","true");var r=document.createElement("div");r.className="tab-image-container-inner";var s=document.createElement("img");s.className="tab-image old-image",s.src="assets/av_default_tab_list_dk.png";var l=document.createElement("div");l.className="tab-image-container-inner";var d=document.createElement("img");d.className="tab-image new-image",d.src="assets/av_default_tab_list_dk.png";var c=document.createElement("div");c.className="splat";var u=document.createElement("div");u.className="tab-text",u.setAttribute("aria-hidden","true");var m=document.createElement("div");m.className="tab-title font-size-primary";var b=document.createElement("bdi");b.textContent=e.title?e.title:window._translations[L],m.appendChild(b),t.setAttribute("aria-label",b.textContent);var v=document.createElement("div");v.className="tab-url font-size-s";var g=document.createElement("bdi");e.url&&e.url!==k.getNewTabUrl()&&(g.textContent=e.url),v.appendChild(g);var h=document.createElement("div");h.className="close-tab-container",h.setAttribute("role","button"),h.setAttribute("aria-label",window._translations[D]);var T=document.createElement("div");T.id="close-tab-"+e.id,T.tabIndex="1",T.style.navLeft="#"+t.id,t.style.navRight="#"+T.id,T.className="close-tab large-icon",T.setAttribute("aria-hidden","true");var E=document.createElement("div");E.className="focus-ring";var y=document.createElement("div");y.className="tab-row-background";var f=document.createElement("div");f.className="tab-row-overlay background",U.add(e.id,{row:t,splat:c,currentImageData:"assets/av_default_tab_list_dk.png",imgContainer:n,newImgContainer:l,newImg:d,oldImgContainer:r,oldImg:s,title:b,url:g,focusRing:E,background:y,closeContainer:h,close:T,overlay:f});var C=function(n){if(n&&n.stopPropagation(),_[e.id])return console.log("Cannot close tab "+e.id+", tab is pending a removal callback"),!0;var i=Y(t),o=U.length(),a=Object.keys(_).length;if(o>1&&o-a>1){var r=p.getTiming(p.DISABLE_TAB),s=U.get(e.id);s.overlay.style.webkitTransitionDuration=r+"ms",s.row.classList.add("tab-row-disabled"),J(e.id),_[e.id]=s}else console.log("Resetting tab "+e.id+", tabList: ["+U.keys()+"], pendingRemovalTabList: ["+Object.keys(_)+"]"),K(e.id),j();F("Close Tab "+i)};T.addEventListener("click",C);var B=function(){t.style.zIndex=1,w!==e.id&&y.classList.add("tab-row-pressed")},x=function(){w!==e.id&&y.classList.remove("tab-row-pressed"),t.style.zIndex=""};t.addEventListener("focus",B),t.addEventListener("blur",x);var A={hoverTargetElement:h,hoverStyleElement:y,onHoverTargetClick:C,onHoverTargetTouchEnd:C,hoverIn:B,hoverOut:x};i(A);var N=function(){return _[e.id]?(console.log("Cannot switch to tab "+e.id+", tab is pending a removal callback"),!0):(M(e.id),F("Switch Tab "+Y(t)),a(e.id),j(),void 0)},H={hoverTargetElement:t,hoverStyleElement:y,onHoverTargetClick:N,onHoverTargetTouchEnd:N,hoverIn:B,hoverOut:x};i(H),u.appendChild(m),u.appendChild(v),n.appendChild(r),r.appendChild(s),n.appendChild(l),l.appendChild(d),l.appendChild(c),h.appendChild(T),n.setAttribute("aria-hidden","true"),t.appendChild(n),u.setAttribute("aria-hidden","true"),t.appendChild(u),t.appendChild(h),E.setAttribute("aria-hidden","true"),t.appendChild(E),y.setAttribute("aria-hidden","true"),t.appendChild(y),f.setAttribute("aria-hidden","true"),t.appendChild(f);var q=document.getElementById("tab-scroll-area"),S=q.getElementsByClassName("selected")[0];S?q.insertBefore(t,S.nextSibling):q.appendChild(t),I.scrollIntoViewIfNecessary(t),1===U.length()&&o()},$=function(e,t){var n=U.get(e);if(!n)return console.log("Trying to update tab "+e+", but its row does not exist. Odd"),void 0;if(t.selected&&a(e),"url"in t&&(n.url.textContent=t.url===k.getNewTabUrl()?"":t.url),"title"in t){var i=t.title?t.title:window._translations[L];n.title.textContent=i,n.row.setAttribute("aria-label",i)}O||(window.opener.require("plugins/tabbar/index").setVisible(),O=!0)},et=function(e,t){var n=U.get(e);return n?(t=t?t:window._translations[L],n.title.textContent=t,n.row.setAttribute("aria-label",t),void 0):(console.log("Trying to update tab title "+e+", but its row does not exist. Odd"),void 0)},tt=function(e){var t=U.get(e);if(!t)return console.log("Could not remove tab "+e+", already removed from the tab list"),void 0;console.log("Animating removing tab "+e);var n=p.getTiming(p.DELETE_TAB);t.overlay.style.webkitTransitionDuration=n+"ms",I.transitionWithTimeout(t.row,function(){t.row.classList.add("tab-row-deleted")},n+50,function(){console.log("Removing tab "+e),y.unregister({hoverTargetElement:function(){return t.row}}),y.unregister({hoverTargetElement:function(){return t.closeContainer}}),t.row.parentElement.removeChild(t.row),U.remove(e),delete _[e]})},nt=function(e){e.forEach(function(e){U.contains(e.id)||console.log("Tab "+e.id+" created before tabbar initalization complete, attempting to create now"),Z(e),$(e.id,e)})},it=function(e,t){var n=U.get(e);if(!n)return console.log("Trying to update the thumbnail of tab "+e+", but its row does not exist. Odd"),void 0;if(n.currentImageData!==t){if(n.updatingThumbnail)return n.pendingThumbnail=t,void 0;n.updatingThumbnail=!0,n.newImgContainer.style.webkitTransitionDuration="0ms",n.newImgContainer.style.opacity=0,n.newImg.onload=r.bind(this,e),n.newImg.src=t,n.currentImageData=t}},ot=function(e){e?document.getElementById("homepage-tab").setAttribute("class","tab-row"):document.getElementById("homepage-tab").setAttribute("class","tab-row hidden")},at=function(){var e=document.getElementsByClassName("tab-row-selected");e.length&&I.scrollIntoViewIfNecessary(e[0]),s()},rt=function(){var e=document.getElementsByClassName("tab-row-selected");e.length&&e[0].focus()},st=function(e){document.documentElement.dir=f.isRTLLocale()?"rtl":"ltr",document.documentElement.lang=C.language();var t=window._translations[B];document.getElementById("homepage-tab-title").innerText=t,t=window._translations[x],document.getElementById("bookmarks-tab-title").innerText=t,t=window._translations[A],document.getElementById("history-tab-title").innerText=t,t=window._translations[N],document.getElementById("new-tab-title").innerText=t,t=window._translations[D];for(var n=document.getElementsByClassName("close-tab-container"),i=0;n.length>i;i++)n[i].setAttribute("aria-label",t);b&&(document.getElementById("bookmarks-shortcut").innerText=window._translations[H],document.getElementById("history-shortcut").innerText=window._translations[q]),e&&e()},lt=function(e,t){document.documentElement.style.fontFamily=e+", sans-serif",document.documentElement.style.fontSize=t+"px"},dt=function(e){lt(e[0],e[1])},ct=function(){if(b=window.matchMedia("(-blackberry-physical-keyboard)").matches){var e=document.createElement("div");e.className="shortcut font-size-xxs",e.id="bookmarks-shortcut",e.setAttribute("aria-hidden",!0),document.getElementById("bookmarks-tab").appendChild(e),e=document.createElement("div"),e.className="shortcut font-size-xxs",e.id="history-shortcut",e.setAttribute("aria-hidden",!0),document.getElementById("history-tab").appendChild(e)}window.opener.require("iris/touch");var t=document.getElementById("homepage-tab"),n=t.getElementsByClassName("tab-row-background")[0],o=document.getElementById("bookmarks-tab"),a=o.getElementsByClassName("tab-row-background")[0],r=document.getElementById("history-tab"),s=r.getElementsByClassName("tab-row-background")[0],v=document.getElementById("new-tab"),w=v.getElementsByClassName("tab-row-background")[0],g=function(e,t,n){return function(i){l(n),e(i),F(t),j()}},h=function(e){e.classList.add("tab-row-pressed")},y=function(e){e.classList.remove("tab-row-pressed")},f=p.getTiming(p.TABBAR_ITEM_HIGHLIGHT_HOVER_OUT),C=g(P,B,n);i({hoverTargetElement:t,hoverStyleElement:n,onHoverTargetClick:C,onHoverTargetTouchEnd:C}),t.addEventListener("focus",h.bind(this,n)),t.addEventListener("blur",y.bind(this,n)),n.style.webkitTransitionDuration=f+"ms";var k=g(z,x,a);i({hoverTargetElement:o,hoverStyleElement:a,onHoverTargetClick:k,onHoverTargetTouchEnd:k}),o.addEventListener("focus",h.bind(this,a)),o.addEventListener("blur",y.bind(this,a)),a.style.webkitTransitionDuration=f+"ms";var _=g(V,A,s);i({hoverTargetElement:r,hoverStyleElement:s,onHoverTargetClick:_,onHoverTargetTouchEnd:_}),r.addEventListener("focus",h.bind(this,s)),r.addEventListener("blur",y.bind(this,s)),s.style.webkitTransitionDuration=f+"ms";var L=g(G,N,w);i({hoverTargetElement:v,hoverStyleElement:w,onHoverTargetClick:L,onHoverTargetTouchEnd:L}),v.addEventListener("focus",h.bind(this,w)),v.addEventListener("blur",y.bind(this,w)),w.style.webkitTransitionDuration=f+"ms",document.getElementById("tab-scroll-area").addEventListener("scroll",d),document.documentElement.addEventListener("click",j),lt(T.systemFontFamily,T.systemFontSize),window.tabbar=window.tabbar||{},window.tabbar.onCreated=Z,window.tabbar.onUpdated=$,window.tabbar.onRemoved=tt,window.tabbar.tabInfoUpdated=nt,window.tabbar.updateTitle=et,window.tabbar.thumbnailUpdated=it,window.tabbar.requestNewScreenshots=X,window.tabbar.setHomePageButtonVisible=ot,window.tabbar.ensureCurrentTabVisible=at,window.tabbar.setFocusOnSelectedTab=rt,window.tabbar.onFontChange=dt,window.tabbar.applyTranslations=st,window.tabbar.preventUserInteraction=I.preventUserInteraction,window.tabbar.allowUserInteraction=I.allowUserInteraction,window.tabbar.cancelPendingTabRemoval=c,window.tabbar.getFocusedTabId=u,E.on("tabbar.showing",m.bind(this,!1)),E.on("tabbar.hidden",m.bind(this,!0)),E.on("PropertyScreenReaderEnabledEvent",function(e,t){m(!t)}),E.on("tabs.removed",tt),E.on("application.systemFontChange",dt),E.on("application.rotateDone",at),window.addEventListener("contextmenu",function(e){e.preventDefault()}),window.opener.require("plugins/tabbar/index").extensionPrivate.applyTranslations(),Q(),console.log("tabbar initialization complete")};window.addEventListener("load",ct),window.addEventListener("orientationchange",o)}();